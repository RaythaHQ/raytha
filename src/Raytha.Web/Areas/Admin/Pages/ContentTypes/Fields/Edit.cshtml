@page "/raytha/{contentTypeDeveloperName}/fields/edit/{id}"
@using Microsoft.AspNetCore.Routing
@using Raytha.Web.Areas.Shared.Models
@model Raytha.Web.Areas.Admin.Pages.ContentTypes.Fields.Edit

@{
    var pageTitle = $"{Model.CurrentView.ContentType.LabelPlural} > Fields > Edit field";
    Layout = "SubActionLayout";
    ViewData["Title"] = pageTitle;
    ViewData["ActiveMenu"] = Model.CurrentView.ContentType.DeveloperName;

    var back = new BackLinkOptions
    {
        Page = RouteNames.ContentTypes.Fields.Index,
        RouteValues = new RouteValueDictionary
        {
            ["contentTypeDeveloperName"] = Model.CurrentView.ContentType.DeveloperName
        },
        Text = "Back to fields"
    };
}

@(await Html.PartialAsync("_Partials/BackToList", back))
<form asp-page="@RouteNames.ContentTypes.Fields.Edit" method="post" class="py-4" id="field-edit-form">
    <div class="col-lg-12 col-md-12">
        <div class="mb-3">
            <label class="form-label raytha-required" asp-for="Form.Label"></label>
            <input type="text" class="form-control @Model.HasError("Label")" asp-for="Form.Label" required>
            <div class="invalid-feedback">@Model.ErrorMessageFor("Label")</div>
        </div>
    </div>
    <div class="col-lg-12 col-md-12">
        <div class="mb-3">
            <label class="form-label" asp-for="Form.DeveloperName"></label>
            <input type="text" class="form-control @Model.HasError("DeveloperName")" asp-for="Form.DeveloperName"
                readonly>
            <div class="invalid-feedback">@Model.ErrorMessageFor("DeveloperName")</div>
            <div class="form-text">Developer name cannot be changed after creation.</div>
        </div>
    </div>
    <div class="col-lg-12">
        <div class="mb-3">
            <label class="form-label" asp-for="Form.FieldType"></label>
            <select class="form-select @Model.HasError("FieldType")" asp-for="Form.FieldType"
                asp-items="@(new SelectList(Model.AvailableFieldTypes, "Key", "Value"))" disabled>
                <option value="">-- SELECT --</option>
            </select>
            <div class="invalid-feedback">@Model.ErrorMessageFor("FieldType")</div>
            <div class="form-text">Field type cannot be changed after creation.</div>
        </div>
    </div>
    @if (!string.IsNullOrEmpty(Model.Form.RelatedContentTypeId))
    {
        <div class="col-lg-12">
            <div class="mb-3">
                <label class="form-label" asp-for="Form.RelatedContentTypeId"></label>
                <select class="form-select @Model.HasError("RelatedContentType")" asp-for="Form.RelatedContentTypeId"
                    asp-items="@(new SelectList(Model.AvailableContentTypes, "Key", "Value"))" disabled>
                    <option value="">-- SELECT --</option>
                </select>
                <div class="invalid-feedback">@Model.ErrorMessageFor("RelatedContentType")</div>
                <div class="form-text">Related content type cannot be changed after creation.</div>
            </div>
        </div>
    }
    @* TODO: Add vanilla JS to show/hide this section based on field type and implement add/remove/reorder functionality *@
    @if (Model.Form.Choices != null && Model.Form.Choices.Any())
    {
        <div class="col-lg-12">
            <div class="mb-3">
                <label class="form-label raytha-required" asp-for="Form.Choices">Choices</label>
                <div class="form-text mb-2">Modify the choices for this select field</div>
                <div id="choicesList">
                    @for (int i = 0; i < Model.Form.Choices.Count(); i++)
                    {
                        <div class="row mb-2">
                            <div class="col-5">
                                <input type="text" name="Choices[@i].Label" class="form-control @Model.HasError("Choices")"
                                    placeholder="Label" value="@(Model.Form.Choices[i].Label)" required>
                                @if (i == Model.Form.Choices.Count() - 1)
                                {
                                    <div class="invalid-feedback">@Model.ErrorMessageFor("Choices")</div>
                                }
                            </div>
                            <div class="col-5">
                                <input type="text" name="Choices[@i].DeveloperName"
                                    class="form-control @Model.HasError("Choices")" placeholder="Developer Name"
                                    value="@(Model.Form.Choices[i].DeveloperName)" required>
                            </div>
                            <div class="col-2">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="Choices[@i].Disabled"
                                        value="@(Model.Form.Choices[i].Disabled ? "true" : "false")"
                                        @(Model.Form.Choices[i].Disabled ? "checked" : "")>
                                    <label class="form-check-label">Disabled</label>
                                </div>
                            </div>
                        </div>
                    }
                </div>
                <div class="form-text text-muted mt-2">Note: Dynamic add/remove/reorder functionality pending implementation
                </div>
            </div>
        </div>
    }
    <div class="col-lg-12 mt-4">
        <div class="mb-3">
            <label class="form-label" asp-for="@Model.Form.IsRequired"></label>
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" asp-for="@Model.Form.IsRequired">
            </div>
            <div class="invalid-feedback">@Model.ErrorMessageFor("IsRequired")</div>
        </div>
    </div>

    <div class="col-lg-12 mt-4">
        <div class="mb-3">
            <label class="form-label" asp-for="@Model.Form.Description"></label>
            <textarea class="form-control @Model.HasError("Description")" asp-for="@Model.Form.Description"></textarea>
            <div class="invalid-feedback">@Model.ErrorMessageFor("Description")</div>
        </div>
    </div>
    <input type="hidden" asp-for="@Model.Form.Id">
    <input type="hidden" asp-for="@Model.Form.FieldType">
    <input type="hidden" asp-for="@Model.Form.ContentTypeId">
    <button type="submit" class="btn btn-success mt-4">Save</button>
</form>