@page "/raytha/{contentTypeDeveloperName}/views/public-settings/{viewId}"
@model Raytha.Web.Areas.Admin.Pages.ContentTypes.Views.PublicSettings

@{
    var pageTitle = $"{Model.CurrentView!.ContentType.LabelPlural} > Views > Public Settings";
    Layout = "SidebarLayout";
    ViewData["Title"] = pageTitle;
    ViewData["ActiveMenu"] = Model.CurrentView.ContentType.DeveloperName;
    var back = new BackLinkOptions
    {
        Href = Model.BackToListUrl,
        Page = RouteNames.ContentTypes.Views.Index,
        RouteValues = new RouteValueDictionary
        {
            ["contentTypeDeveloperName"] = Model.CurrentView.ContentType.DeveloperName,
            ["id"] = Model.CurrentView.Id
        }
    };
}

<div>
    <div class="row mb-4">
        <partial name="_Partials/PageHeading" model='ViewData["Title"]' />
        <div class="col-xxl-7 col-xl-8 col-lg-9 col-md-12">
            <div class="card border-0 shadow mb-4">
                <div class="card-body">
                    @(await Html.PartialAsync("_Partials/BackToList", back))
                    <form asp-page="@RouteNames.ContentTypes.Views.PublicSettings" method="post" class="py-4"
                        asp-route-contentTypeDeveloperName="@Model.CurrentView.ContentType.DeveloperName"
                        asp-route-id="@Model.CurrentView.Id" asp-route-backToListUrl="@Model.BackToListUrl" novalidate>

                        <div class="col-lg-12">
                            <div class="mb-3">
                                <label class="form-label raytha-required" asp-for="TemplateId">Template</label>
                                <select class="form-select @Model.HasError("TemplateId")" asp-for="TemplateId" required>
                                    <option value="">-- SELECT --</option>
                                    @foreach (var template in Model.AvailableTemplates)
                                    {
                                        <option value="@template.Key">@template.Value</option>
                                    }
                                </select>
                                <div class="invalid-feedback">@Model.ErrorMessageFor("TemplateId")</div>
                            </div>
                        </div>

                        <div class="col-lg-12">
                            <label class="form-label raytha-required" asp-for="RoutePath">Route path</label>
                            <div class="input-group mb-3">
                                <span class="input-group-text">@Model.WebsiteUrl</span>
                                <input type="text" class="form-control @Model.HasError("RoutePath")" asp-for="RoutePath"
                                    required>
                                <div class="invalid-feedback">@Model.ErrorMessageFor("RoutePath")</div>
                            </div>
                        </div>

                        <div class="col-lg-12">
                            <div class="mb-3">
                                <label class="form-label" asp-for="IsPublished">Is Published</label>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" asp-for="IsPublished">
                                </div>
                                <div class="invalid-feedback">@Model.ErrorMessageFor("IsPublished")</div>
                            </div>
                        </div>

                        <div class="col-lg-12 col-md-12">
                            <div class="mb-3">
                                <label class="form-label raytha-required" asp-for="DefaultNumberOfItemsPerPage">Default
                                    number of items per page</label>
                                <input type="number" class="form-control @Model.HasError("DefaultNumberOfItemsPerPage")"
                                    asp-for="DefaultNumberOfItemsPerPage" required>
                                <div class="invalid-feedback">@Model.ErrorMessageFor("DefaultNumberOfItemsPerPage")
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-12 col-md-12">
                            <div class="mb-3">
                                <label class="form-label raytha-required" asp-for="MaxNumberOfItemsPerPage">Maximum
                                    number of items per page</label>
                                <input type="number" class="form-control @Model.HasError("MaxNumberOfItemsPerPage")"
                                    asp-for="MaxNumberOfItemsPerPage" required>
                                <div class="invalid-feedback">@Model.ErrorMessageFor("MaxNumberOfItemsPerPage")</div>
                            </div>
                        </div>

                        <div class="col-lg-12 my-4">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox"
                                    asp-for="IgnoreClientFilterAndSortQueryParams">
                                <label class="form-check-label" asp-for="IgnoreClientFilterAndSortQueryParams">
                                    Ignore client filter and sort query params
                                </label>
                            </div>
                            <div class="form-text">
                                Turn on this option if you do not want public consumers to be able to layer their own
                                filtering or sorting on top of the view's configuration.
                            </div>
                        </div>

                        <div class="col-lg-12">
                            <button type="submit" class="btn btn-success mx-2">Save changes</button>
                        </div>
                    </form>

                    @if (Model.CanManageSystemSettings)
                    {
                        <br />
                        <hr />

                        if (!Model.IsHomePage)
                        {
                            <form method="post" asp-page="@RouteNames.ContentTypes.Views.PublicSettings"
                                asp-page-handler="SetAsHomePage" class="py-4"
                                asp-route-contentTypeDeveloperName="@Model.CurrentView.ContentType.DeveloperName"
                                asp-route-viewId="@Model.CurrentView.Id" asp-route-backToListUrl="@Model.BackToListUrl">
                                <div class="col-lg-12">
                                    <button type="submit" class="btn btn-secondary mx-2">Set as home page</button>
                                </div>
                            </form>
                        }
                        else
                        {
                            <p class="py-4">This list view is currently set as the home page.</p>
                        }
                    }

                </div>
            </div>
        </div>
    </div>
</div>